<!-- src/app/components/remittance-form/remittance-form.component.html -->
<div class="remittance-form-container">
    <h2>Send Money</h2>

    <!-- Missing [formGroup] attribute on the form element -->
    <form [formGroup]="remittanceForm" (ngSubmit)="onSubmit()">
        <div class="form-group">
            <label for="amount">Amount</label>
            <div class="input-group">
                <input type="number" id="amount" formControlName="amount" placeholder="Enter amount">
                <select id="currency-select" formControlName="currency" title="Select currency">
                    <option *ngFor="let currency of currencies" [value]="currency">{{currency}}</option>
                </select>
            </div>
            <div class="error-message"
                *ngIf="remittanceForm.get('amount')?.touched && remittanceForm.get('amount')?.errors?.['required']">
                Amount is required
            </div>
            <div class="error-message"
                *ngIf="remittanceForm.get('amount')?.touched && remittanceForm.get('amount')?.errors?.['min']">
                Amount must be positive
            </div>
        </div>

        <div class="form-group recipient-section" *ngIf="!showAddRecipient">
            <label for="recipient">Recipient</label>
            <select id="recipient" formControlName="recipient">
                <option value="" disabled selected>Select a recipient</option>
                <option *ngFor="let recipient of recipients" [value]="recipient.id">
                    {{recipient.name}} - {{recipient.country}}
                </option>
            </select>
            <button type="button" (click)="toggleAddRecipient()" class="link-button">+ Add New Recipient</button>
            <div class="error-message"
                *ngIf="remittanceForm.get('recipient')?.touched && remittanceForm.get('recipient')?.errors?.['required']">
                Please select a recipient
            </div>
        </div>

        <div class="new-recipient-section" *ngIf="showAddRecipient" formGroupName="newRecipient">
            <h3>New Recipient</h3>
            <div class="form-group">
                <label for="name">Name</label>
                <input type="text" id="name" formControlName="name" placeholder="Recipient name">
            </div>
            <div class="form-group">
                <label for="accountNumber">Account Number</label>
                <input type="text" id="accountNumber" formControlName="accountNumber" placeholder="Account number">
            </div>
            <div class="form-group">
                <label for="bankName">Bank Name</label>
                <input type="text" id="bankName" formControlName="bankName" placeholder="Bank name">
            </div>
            <div class="form-group">
                <label for="country">Country</label>
                <input type="text" id="country" formControlName="country" placeholder="Country">
            </div>
            <div class="form-group">
                <label for="email">Email (Optional)</label>
                <input type="email" id="email" formControlName="email" placeholder="Email address">
            </div>
            <div class="form-group">
                <label for="phoneNumber">Phone Number (Optional)</label>
                <input type="text" id="phoneNumber" formControlName="phoneNumber" placeholder="Phone number">
            </div>
            <button type="button" (click)="toggleAddRecipient()" class="link-button">Use Existing Recipient</button>
        </div>

        <div class="form-group">
            <label for="paymentMethod">Payment Method</label>
            <select id="paymentMethod" formControlName="paymentMethod">
                <option *ngFor="let method of paymentMethods" [value]="method">{{method | titlecase}}</option>
            </select>
        </div>

        <div class="transaction-summary">
            <h3>Transaction Summary</h3>
            <div class="summary-row">
                <span>Amount:</span>
                <span>{{remittanceForm.get('amount')?.value || 0 | currency:(remittanceForm.get('currency')?.value ||
                    'USD')}}</span>
            </div>
            <div class="summary-row">
                <span>Exchange Rate:</span>
                <span>1 USD = {{exchangeRate}} {{remittanceForm.get('currency')?.value || 'USD'}}</span>
            </div>
            <div class="summary-row">
                <span>Fees:</span>
                <span>{{fees | currency:(remittanceForm.get('currency')?.value || 'USD')}}</span>
            </div>
            <div class="summary-row total">
                <span>Total Amount:</span>
                <span>{{totalAmount | currency:(remittanceForm.get('currency')?.value || 'USD')}}</span>
            </div>
        </div>

        <div class="form-actions">
            <button type="button" (click)="cancel()" class="cancel-button">Cancel</button>
            <button type="submit" class="send-button" [disabled]="submitting">
                <span *ngIf="!submitting">Send Money</span>
                <span *ngIf="submitting">Processing...</span>
            </button>
        </div>
    </form>
</div>